<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>BukkitUtils</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">BukkitUtils</h1>
	<p class="header">Set of bukkit utilities</p>

        <ul>
          <li class="download"><a class="buttons" href="http://ln2.fr/bukkitutils">Download JAR</a></li>
          <li class="download"><a class="buttons" href="https://github.com/aumgn/BukkitUtils/zipball/master">Download SRC</a></li>
          <li><a class="buttons github" href="https://github.com/aumgn/BukkitUtils">View On GitHub</a></li>
        </ul>


      </header>
      <section>
        <h2>Download: </h2>
	<p>You can found the latest release <a href="http://ln2.fr/bukkitutils">here</a>.</p>
	<p>For older and development versions, see <a href="http://maven.aumgn.fr/fr/aumgn/bukkitutils">my maven repository</a>.</p>

	<h2>Developers :</h2>
	<h3>Installation :</h3>
	<p>
	  BukkitUtils is an external library that must be provided at runtime.
	  The easiest way to do that is to add a class path entry to your plugin's MANIFEST.
	  With Maven you just have to configure the maven-jar-plugin as follows:
	</p>

	<div class="highlight">
<pre>
    <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>maven-jar-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>2.3.2<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;configuration&gt;</span>
            <span class="nt">&lt;archive&gt;</span>
                <span class="nt">&lt;manifestEntries&gt;</span>
                    <span class="nt">&lt;Class-Path&gt;</span>../lib/BukkitUtils.jar<span class="nt">&lt;/Class-Path&gt;</span>
                <span class="nt">&lt;/manifestEntries&gt;</span>
            <span class="nt">&lt;/archive&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/plugin&gt;</span>
</pre>
	</div>

	<p>
	  Which means the user will have to provide the library at the corresponding path.
	  You should prefer this path, because this is the one which is used by other plugins.
	</p>

	<p>
	  Another way is to use the maven-shade-plugin to bundle BukkitUtils inside your plugin.
	  In this case you may want to use its relocation feature to avoid version conflicts
	  with other plugins using BukkitUtils
	</p>
	<p>
	  Take a look at my plugin
	  <a href="https://github.com/aumgn/DACv2/blob/master/pom.xml#L143-185">DACv2's pom</a>
	  to see how you can use this two solutions together with a maven profile.
	</p>


	<h3>Documentation</h3>
	<p>The javadoc is available <a href="apidocs/">here</a>.</p>

	<h3>Usage</h3>
	<p>BukkitUtils include different utilities :</p>
	<ul>
	  <li>localization : Localization utilities</li>
	  <li>commands : A set of classes and annotations to write commands more easily (heavily inspired from WorldEdit commands system).</li>
	  <li>gson: A tiny gson wrapper with convenient type adaptaters.</li>
	  <li>playerref : A class (PlayerRef) and its associated collections to store players based on their name seamlessly.</li>
	  <li>and a lot of other utilities class and interface like immutable vectors, directions, timer, etc ...</li>
	</ul>

	<h4>Commands</h4>
	<p>Here are some examples of how you would write commands with BukkitUtils : </p>
	<div class="highlight">
<pre>    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyCommands</span> <span class="kd">extends</span> <span class="n">Commands</span> <span class="o">{</span>

        <span class="c1">// ** Simplest command</span>
        <span class="nd">@Command</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"test"</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="n">CommandSender</span> <span class="n">sender</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">sender</span><span class="o">.</span><span class="na">sendMessage</span><span class="o">(</span><span class="s">"Foo !"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// ** Player only command</span>
        <span class="nd">@Command</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"test2"</span><span class="o">)</span>
        <span class="n">pubic</span> <span class="kt">void</span> <span class="nf">test2</span><span class="o">(</span><span class="n">Player</span> <span class="n">sender</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">sender</span><span class="o">.</span><span class="na">sendMessage</span><span class="o">(</span><span class="s">"Position: "</span> <span class="o">+</span> <span class="k">new</span> <span class="n">Vector</span><span class="o">(</span><span class="n">sender</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="c1">// ** Command with two arguments</span>
        <span class="nd">@Command</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"test3"</span><span class="o">,</span> <span class="n">min</span> <span class="o">=</span> <span class="mi">2</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">2</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test3</span><span class="o">(</span><span class="n">CommandSender</span> <span class="n">sender</span><span class="o">,</span> <span class="n">CommandArg</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">sender</span><span class="o">.</span><span class="na">sendMessage</span><span class="o">(</span><span class="s">"Arguments: "</span> <span class="o">+</span> <span class="n">args</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="s">" - "</span> <span class="o">+</span> <span class="n">args</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="c1">// ** Commands with complex arguments</span>
        <span class="c1">// Try to parse the first argument as a partial player name.</span>
        <span class="c1">// This will send a message and abort the command if no player </span>
        <span class="c1">// or if more than one player is/are found.</span>
        <span class="c1">// If no argument is given (which is accepted since </span>
        <span class="c1">// min is set to 0), the library will return back the</span>
        <span class="c1">// sender if it's a player or throw an exception</span>
        <span class="c1">// (which will send a nice error message to the user)</span>
        <span class="c1">// if it's not.</span>
        <span class="nd">@Command</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"test4"</span><span class="o">,</span> <span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test4</span><span class="o">(</span><span class="n">CommandSender</span> <span class="n">sender</span><span class="o">,</span> <span class="n">CommandArgs</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Player</span> <span class="n">player</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="na">getPlayer</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">valueOr</span><span class="o">(</span><span class="n">sender</span><span class="o">);</span>
            <span class="c1">// Note that you can also use match() instead of value()</span>
            <span class="c1">// which would returns a list of all matching players.</span>
            <span class="n">sender</span><span class="o">.</span><span class="na">sendMessage</span><span class="o">(</span><span class="s">"Utilisation de la commande sur :"</span>
                <span class="o">+</span> <span class="n">player</span><span class="o">.</span><span class="na">getDisplayName</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="c1">// ** List arguments</span>
        <span class="c1">// Using getPlayers instead of getPlayer will returns a list.</span>
        <span class="c1">// For example : "au,notch" will returns a list of </span>
        <span class="c1">// all players whose name matches au or notch</span>
        <span class="nd">@Command</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"test5"</span><span class="o">,</span> <span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test5</span><span class="o">(</span><span class="n">CommandSender</span> <span class="n">sender</span><span class="o">,</span> <span class="n">CommandArgs</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">Player</span><span class="o">&gt;</span> <span class="n">players</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="na">getPlayers</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">match</span><span class="o">(</span><span class="n">sender</span><span class="o">);</span>
            <span class="n">sender</span><span class="o">.</span><span class="na">sendMessage</span><span class="o">(</span><span class="s">"Utilisation de la commande sur :"</span><span class="o">);</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">Player</span> <span class="n">player</span> <span class="o">:</span> <span class="n">players</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">sender</span><span class="o">.</span><span class="na">sendMessage</span><span class="o">(</span><span class="s">" - "</span> <span class="o">+</span> <span class="n">player</span><span class="o">.</span><span class="na">getDisplayName</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="c1">// ** Commands with flags</span>
        <span class="c1">// Available flags must be declared in the annotation.</span>
        <span class="c1">// If an invalid flag is used the sender will be notified.</span>
        <span class="nd">@Command</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"test6"</span><span class="o">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="s">"at"</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test6</span><span class="o">(</span><span class="n">CommandSender</span> <span class="n">sender</span><span class="o">,</span> <span class="n">CommandArgs</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">hasFlag</span><span class="o">(</span><span class="sc">'a'</span><span class="o">))</span> <span class="o">{</span>
                <span class="c1">// Do something</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">hasFlag</span><span class="o">(</span><span class="sc">'t'</span><span class="o">))</span> <span class="o">{</span>
                <span class="c1">// Do something else</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="c1">// ** Commands with argument flags</span>
        <span class="c1">// The syntax is : "/test6 -p=au -w=world"</span>
        <span class="nd">@Command</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"test6"</span><span class="o">,</span> <span class="n">argsFlags</span> <span class="o">=</span> <span class="s">"pw"</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test6</span><span class="o">(</span><span class="n">CommandSender</span> <span class="n">sender</span><span class="o">,</span> <span class="n">CommandArgs</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">hasArgFlag</span><span class="o">(</span><span class="sc">'p'</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">Player</span> <span class="n">player</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="na">getPlayer</span><span class="o">(</span><span class="sc">'p'</span><span class="o">).</span><span class="na">value</span><span class="o">();</span>
                <span class="c1">// Do something with player.</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">hasArgFlag</span><span class="o">(</span><span class="sc">'w'</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">World</span> <span class="n">world</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="na">getWorld</span><span class="o">(</span><span class="sc">'w'</span><span class="o">).</span><span class="na">value</span><span class="o">();</span>
                <span class="c1">// Do something with world.</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
</pre>
	</div>

	<p>In to order to register your commands you just have to use the class CommandsRegistration : </p>

	<pre><code>    CommandsRegistration registration =
            new CommandsRegistration(plugin, config.getLocale());
    registration.register(new MyCommands());
</code></pre>

	<p>
	  This command system is quite powerful and extensible.
	  You can add your own arguments parsers using the classes CommandArg and CommandArgsFactory.
	  You'll find examples in the source code or in <a href="https://github.com/aumgn/">my other plugins</a>.
	</p>

	<p>
	  The main advantages of this system over others is that all commands (even nested commands) are first citizens Bukkit commands.
	  Which means they are declared in the plugin.yml with their own permission, that also means that users can declare their own
	  aliases in the bukkit.yml file !
	</p>

	<h4>Configuration Example</h4>
	<p>Here's how you could write using the gson wrapper : </p>
	<div class="highlight">
<pre>    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyConfig</span> <span class="o">{</span>

        <span class="kd">private</span> <span class="kt">int</span> <span class="n">entry1</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">entry2</span> <span class="o">=</span> <span class="s">"string"</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">entry3</span> <span class="o">=</span> <span class="s">"BLUE"</span><span class="o">;</span>

        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getEntry1</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">entry1</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getEntry2</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">entry2</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="n">ChatColor</span> <span class="nf">getEntry3</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">ChatColor</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">entry3</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IllegalArgumentException</span> <span class="n">exc</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">MyPlugin</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">()).</span><span class="na">severe</span><span class="o">(</span><span class="s">"Invalid color for entry2."</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">ChatColor</span><span class="o">.</span><span class="na">BLUE</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyPlugin</span> <span class="kd">extends</span> <span class="n">JavaPlugin</span> <span class="o">{</span>

        <span class="kd">private</span> <span class="n">MyConfig</span> <span class="n">config</span><span class="o">;</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onEnable</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GsonBuilder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">setPrettyPrinting</span><span class="o">()</span>
                <span class="o">.</span><span class="na">create</span><span class="o">();</span>
            <span class="n">GsonLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GsonLoader</span><span class="o">(</span><span class="n">gson</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>

            <span class="k">try</span> <span class="o">{</span>
                <span class="n">config</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"config.json"</span><span class="o">,</span> <span class="n">MyConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">GsonLoadException</span> <span class="n">exc</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">getLogger</span><span class="o">().</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">SEVERE</span><span class="o">,</span> <span class="s">"Unable to load config.json"</span><span class="o">,</span> <span class="n">exc</span><span class="o">);</span>
                <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyConfig</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
</pre>
	</div>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
